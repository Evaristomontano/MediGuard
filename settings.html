<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-i18n="title">MediGuard - Settings</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { color-scheme: light !important; }
        body { 
            font-family: 'Inter', sans-serif !important; 
            background-color: #f8fafc !important; 
            color: #1e293b !important;
        }
        img, .flag-img { filter: none !important; -webkit-filter: none !important; }
        
        /* Botón Back reforzado para evitar desaparición en móviles */
        .back-btn-solid {
            display: flex !important;
            align-items: center !important;
            background-color: #eff6ff !important;
            color: #1d4ed8 !important;
            padding: 10px 16px !important;
            border-radius: 12px !important;
            font-weight: 700 !important;
            border: 1px solid #dbeafe !important;
            text-decoration: none !important;
            transition: all 0.2s;
        }
        .back-btn-solid:active { transform: scale(0.95); }
    </style>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1d4ed8">
</head>
<body class="bg-slate-50 min-h-screen">

    <header class="bg-white border-b border-slate-200 py-6 mb-8 shadow-sm">
        <div class="max-w-4xl mx-auto px-4 flex items-center justify-between">
            <h1 class="text-xl font-bold text-blue-700 uppercase tracking-wider">MediGuard</h1>
            
            <a href="/" class="back-btn-solid">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                <span data-i18n="btn_back">Back</span>
            </a>
        </div>
    </header>

    <<div class="fixed top-4 right-4 flex space-x-3 bg-white p-2 px-4 rounded-full shadow-lg z-50 items-center border border-slate-200">
        <button onclick="setLanguage('en')" class="hover:scale-110 transition-transform w-6">
            <img src="https://flagcdn.com/us.svg" alt="EN" class="flag-img block">
        </button>
        <button onclick="setLanguage('es')" class="hover:scale-110 transition-transform w-6">
            <img src="https://flagcdn.com/es.svg" alt="ES" class="flag-img block">
        </button>
        <button onclick="setLanguage('de')" class="hover:scale-110 transition-transform w-6">
            <img src="https://flagcdn.com/de.svg" alt="DE" class="flag-img block">
        </button>
         <div class="w-px h-4 bg-slate-200 mx-1"></div>
    </div>

    <main class="max-w-2xl mx-auto px-6 pb-20">
        <section class="bg-white rounded-2xl shadow-xl p-8 mb-8 border border-slate-100">
            <h2 data-i18n="settings_title" class="text-slate-800 font-bold text-2xl mb-4">Gemini API Configuration</h2>
            <p data-i18n="settings_desc" class="text-slate-500 text-sm mb-8 italic">Saved only in your browser.</p>
            
            <div class="space-y-6">
                <div>
                    <label data-i18n="label_key" class="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">API Key</label>
                    <input type="password" id="apiKeyInput" placeholder="AIza..." 
                        class="w-full p-4 rounded-xl border border-slate-200 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-all font-mono">
                </div>
                
                <div class="bg-blue-50 rounded-xl p-6 mb-6">
                    <h3 data-i18n="guide_title" class="font-bold text-blue-800 mb-3">Setup Guide</h3>
                    <ul class="text-sm text-blue-700 space-y-3">
                        <li id="step1">1. Visit Google AI Studio.</li>
                        <li id="step2">2. Click "Create API Key".</li>
                        <li id="step3">3. Paste it here.</li>
                    </ul>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="inline-block mt-4 text-sm font-bold underline text-blue-600">Google AI Studio →</a>
                </div>

                <button onclick="saveKey()" data-i18n="btn_save" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95">
                    Save Configuration
                </button>
                <p id="saveMsg" class="text-center text-sm text-green-600 font-medium hidden" data-i18n="save_success">✓ Saved!</p>
            </div>
        </section>
    </main>

    <script>
        let currentLang = localStorage.getItem('preferredLang') || 'en';
        const translations = {
            en: {
                title: "MediGuard - Settings",
                btn_back: "Back",
                settings_title: "Gemini API Configuration",
                settings_desc: "We use your own Gemini key to keep this tool free. It stays in your browser.",
                label_key: "Your API Key",
                guide_title: "How to get a key?",
                step1: "1. Visit Google AI Studio.",
                step2: "2. Click 'Create API Key'.",
                step3: "3. Copy and paste it here.",
                btn_save: "Save Configuration",
                save_success: "✓ Configuration saved!",
                alert_empty: "Please enter a key."
            },
            es: {
                title: "MediGuard - Configuración",
                btn_back: "Volver",
                settings_title: "Configuración de Gemini API",
                settings_desc: "Usamos tu propia clave de Gemini para que la app sea gratis. Se guarda en tu navegador.",
                label_key: "Tu Clave API",
                guide_title: "¿Cómo conseguir una clave?",
                step1: "1. Entra en Google AI Studio.",
                step2: "2. Pulsa en 'Create API Key'.",
                step3: "3. Copia y pega la clave aquí.",
                btn_save: "Guardar Configuración",
                save_success: "✓ ¡Guardado!",
                alert_empty: "Introduce una clave."
            },
            de: {
                title: "MediGuard - Einstellungen",
                btn_back: "Zurück",
                settings_title: "Gemini API Konfiguration",
                settings_desc: "Wir nutzen Ihren Key, um das Tool kostenlos zu halten. Er bleibt lokal.",
                label_key: "API-Key",
                guide_title: "Key erhalten?",
                step1: "1. Google AI Studio öffnen.",
                step2: "2. 'Create API Key' klicken.",
                step3: "3. Hier einfügen.",
                btn_save: "Speichern",
                save_success: "✓ Gespeichert!",
                alert_empty: "Key eingeben."
            }
        };

        function setLanguage(lang) {
            currentLang = lang;
            const dict = translations[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.innerText = dict[key];
            });
            document.getElementById('step1').innerText = dict.step1;
            document.getElementById('step2').innerText = dict.step2;
            document.getElementById('step3').innerText = dict.step3;
            document.title = dict.title;
            localStorage.setItem('preferredLang', lang);
        }

        document.addEventListener('DOMContentLoaded', () => {
            setLanguage(currentLang);
            document.getElementById('apiKeyInput').value = localStorage.getItem('user_gemini_key') || '';
        });

        function saveKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                localStorage.setItem('user_gemini_key', key);
                document.getElementById('saveMsg').classList.remove('hidden');
                setTimeout(() => window.location.href = '/', 1000);
            } else {
                alert(translations[currentLang].alert_empty);
            }
        }
    </script>
</body>
</html>